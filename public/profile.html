<!DOCTYPE html>
<html>
<head>
  <title>Event planner</title>
  <base href="/">
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap-theme.min.css">

</head>
<body ng-view>

  <div class="navbar navbar-default">
    <div class="container">
      <div id="navbar-main">
        <ul class="nav navbar-nav">
          <li><a href="/">Home</a></li>
          <li><a href="/events.html">Events</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/login.html">Sign in</a></li>
          <li><a href="/profile.html"></a></li>
        </ul>
      </div>
    </div>
  </div>


    <div class="container">
    <div class="row">
        
        <div class="col-md-6">

        <h1 class="form-signin-heading">Profile</h1>

        <form  class="form-horizontal">
            <div class="form-group">
            <label class="col-sm-3 control-label">Full name</label>
            <p class="form-control-static" id="nameParagraph"></p>
            </div>
            <div class="form-group">
            <label class="col-sm-3 control-label">Email</label>
            <p class="form-control-static" id="emailParagraph"></p>
            </div>
             <label class="col-sm-3 control-label">Place</label>
            <p class="form-control-static" id="placeParagraph"></p>
            </div><!--
             <label class="col-sm-3 control-label">lat</label>
            <p class="form-control-static" id="latParagraph"></p>
            </div>
             <label class="col-sm-3 control-label">lng</label>
            <p class="form-control-static" id="lngParagraph"></p>
            </div>-->
            <button type="button" id="followProfile" class="btn btn-primary">Follow</button>
            <button type="button" id="unfollowProfile" class="btn btn-primary">Unfollow</button>(only other users)
            <br>
            <label class="col-sm-3 control-label">Attending</label> 
            <div id="attendingDiv" class="form-group">
            </div>
            <label class="col-sm-3 control-label">Following</label>
            <div id="followingDiv" class="form-group">
            </div>
            <hr>
            <label class="col-sm-3 control-label">Hosting</label>
            <div id="hostingDiv" class="form-group">
            </div>
            <hr>
             <label class="col-sm-3 control-label">All Users</label>
            <div id="profilesDiv" class="form-group">
            </div>
            <hr>
            <label class="col-sm-3 control-label">All Events</label>
            <div id="eventsDiv" class="form-group">
            </div>
        </form>

        </div>

    </div>
    </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="js/authentication.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/common.js"></script>
  <script src="js/events.js"></script>
  <script src="js/profiles.js"></script>

  <script>

            fetchAllEvents()
              .then(function(res) {
                  //console.log(res);
                  res.forEach((event) => {
                    $('#eventsDiv').prepend(`${event.title} <a href="/event.html?_id=${event._id}">link</a> <br>`);
                  });
              })
              .catch(function(err){
                  console.log(err);
              });

            fetchAllProfiles()
              .then(function(res) {
                  //console.log(res);
                  res.forEach((profile) => {
                    $('#profilesDiv').prepend(`${profile.email} <a href="/profile.html?_id=${profile._id}">link</a> <br>`);
                  });
              })
              .catch(function(err){
                  console.log(err);
              });

            const putProfileToDivs = function(data) {
                    console.log(data);
                    $('#nameParagraph').text(data.name);
                    $('#emailParagraph').text(data.email);
                    $('#attendingDiv').text(data.attending_events);
                    $('#hostingDiv').text(data.hosting_events);
                    $('#followingDiv').text(data.following);
                    $('#placeParagraph').text(data.address_place);
                    //$('#latDiv').text(data.address_lat);
                    //$('#lngDiv').text(data.address_lng);
              }
            // check if there's _id in url and if there is, display given profile instead of the logged one
            const profileId = getUrlParameter('_id');
            if (profileId) {
              fetchProfileById(profileId).then(putProfileToDivs)
                  .catch(function(err){
                      console.log(err);
                  });

              $('#followProfile').on('click', function() {
                    // id taken from url
                    followProfile(profileId)
                        .then(function(result) {
                            console.log(result);
                        })
                        .catch(function(err) {
                            console.log(err);
                        });
                });

                // id taken from url
                $('#unfollowProfile').on('click', function() {
                    unfollowProfile(profileId)
                        .then(function(result) {
                            console.log(result);
                        })
                        .catch(function(err) {
                            console.log(err);
                        });
                });
              } else {
                fetchCurrentProfile().then(putProfileToDivs)
                  .catch(function(err){
                      console.log(err);
                  });
              }

              
        
  </script>
</body>
</html>