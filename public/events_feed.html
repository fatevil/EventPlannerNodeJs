<!DOCTYPE html>
<html>
<head>
  <title>Event planner</title>
 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
  #eventImage {
        height: 350px;
        width: 100%;
  }
  .imageDiv{
    position:relative;
    }
    .post-content {
    margin-top: 120px;
    background: none repeat scroll 0 0 #FFFFFF;
    opacity: 0.9;
    top:0;
    left:0;
    position: absolute;
}
    .no-bottom-margin {
        margin-bottom: 0px;
    }
    
    .stretch-text {
    text-align: justify;
    text-justify: inter-word;    }

     .left-right-padding {
         padding-left: 30px;
         padding-right: 30px;
     }
      .start-hidden {
          display: none;
      }
      .profile-picture-thumbnail {
          width: 50px;
          height: 50px;
      }

      /* slider image text */
        .imageDiv{
            position:relative;
            }
        .post-content {
            margin-top: 180px;
            background: none repeat scroll 0 0 #fff;
            opacity: 0.9;
            top:0;
            left:0;
            position: absolute;
        }
      /* slider */
        .carousel-control {
            padding-top:10%;
            width:5%;
        }
        .img-responsive {
            height: 300px;
        }
        .spaceLine {
            margin: 300px;
            width: 100%;
        }
  </style>

</head>
<body>

  <div class="navbar navbar-default no-bottom-margin">
    <div class="container">
      <div id="navbar-main">
        <ul class="nav navbar-nav">
          <li><a href="/">Home</a></li>
          <li><a href="/events.html">Events</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/login.html">Sign in</a></li>
          <li><a href="/profile.html"></a></li>
        </ul>
      </div>
    </div>
  </div>

<div class="row">
<div class="col-xs-12">
        <h1 class="text-center">Friends <span class="glyphicon glyphicon-cutlery"></span></h1>
        <div id="myCarouselFriends" class="carousel slide">
            
            <!-- Carousel items -->
            <div id="itemsDivFriends" class="carousel-inner">
                
            </div>
            <!--/carousel-inner--> <a class="left carousel-control" href="#myCarouselFriends" data-slide="prev">‹</a>

            <a class="right carousel-control" href="#myCarouselFriends" data-slide="next">›</a>
        </div>
        <!--/myCarousel-->
</div>


<hr class="spaceLine">

<div class="col-xs-12">
        <h1 class="text-center">Food <span class="glyphicon glyphicon-cutlery"></span></h1>
        <div id="myCarouselFood" class="carousel slide">
            
            <!-- Carousel items -->
            <div id="itemsDivFood" class="carousel-inner">
                
            </div>
            <!--/carousel-inner--> <a class="left carousel-control" href="#myCarouselFood" data-slide="prev">‹</a>

            <a class="right carousel-control" href="#myCarouselFood" data-slide="next">›</a>
        </div>
        <!--/myCarousel-->
</div>

<hr class="spaceLine">

<div class="col-xs-12">
        <h1 class="text-center">Shows  <span class="glyphicon glyphicon-bullhorn"></span></h1>
        <div id="myCarouselShow" class="carousel slide">
            
            <!-- Carousel items -->
            <div id="itemsDivShow" class="carousel-inner">
                
            </div>
            <!--/carousel-inner--> <a class="left carousel-control" href="#myCarouselShow" data-slide="prev">‹</a>

            <a class="right carousel-control" href="#myCarouselShow" data-slide="next">›</a>
        </div>
        <!--/myCarousel-->
</div>

<hr class="spaceLine">

<div class="col-xs-12">
        <h1 class="text-center">Others  <span class="glyphicon glyphicon-bullhorn"></span></h1>
        <div id="myCarouselOthers" class="carousel slide">
            
            <!-- Carousel items -->
            <div id="itemsDivOthers" class="carousel-inner">
                
            </div>
            <!--/carousel-inner--> <a class="left carousel-control" href="#myCarouselOthers" data-slide="prev">‹</a>

            <a class="right carousel-control" href="#myCarouselOthers" data-slide="next">›</a>
        </div>
        <!--/myCarousel-->
</div>


    <div class="col-sm-12">
        <hr>
        <label class="col-sm-12 control-label">Events from followed</label>
        <div id="friendsEventsDiv" class="form-group">
        </div>
        <hr>
        <label class="col-sm-12 control-label">Events by location</label>
        <div id="eventsByLocationDiv" class="form-group">
        </div>
        <hr>
        <label class="col-sm-12 control-label">All Events</label>
        <div id="eventsDiv" class="form-group">
        </div>
    </div>
</div>


    

  
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvkp-hH2o_yI7V6rintnrmqZ_uwOZQEpE"></script>
  <script src="js/authentication.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/common.js"></script>
  <script src="js/events.js"></script>
    <script src="js/profiles.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
  <script>

        
        fetchAllEvents()
            .then(function(res) {
                //console.log(res);
                res.forEach((event) => {
                  $('#eventsDiv').prepend(`${event.title} <a href="/event_new.html?_id=${event._id}">link</a> <br>`);
                });
            })
            .catch(function(err){
                console.log(err);
            });
  
        const templateCarouselImage = (src, title, quick, id) => {
            return `
                <div class="col-xs-4">                   
                        <div class="imageDiv">  
                            <a href="/event_new.html?_id=${id}">
                                <img src="${src}" alt="Image" class="img-responsive">
                                <div class="col-sm-12  caption post-content">
                                    <div class="text-center">
                                        <h3 style="margin-top:10px;"><p class="">${title}</p></h3>
                                        
                                    </div>
                                </div>
                            </a>
                        </div>                        
                    </div>
                    `;
        };

        const templateCarouselForm = (id, type) => {
            return `
        <div class="item">
            <div id="carousel-form-${type}-${id}" class="row">
            </div>
        </div>
            `;
        }
        const templateCarouselFormFirst = (id, type) => {
            return `
        <div class="item active">
            <div id="carousel-form-${type}-${id}" class="row">
            </div>
        </div>
            `;
        }

        const fillCarousel = (category, i, event) => {
                if (!event.image) {
                    return;
                }
                let o = Math.floor(i/3);
                if (i % 3 == 0) {
                    if (o == 0) {
                        $('#itemsDiv' + category).append(templateCarouselFormFirst(o, category));
                    } else {
                        $('#itemsDiv' + category).append(templateCarouselForm(o, category));
                    }
                } 
                const item = `#carousel-form-${category}-${o}`;
                $(item).append(templateCarouselImage(event.image.replace("images/", "images/cropped/"), event.title, event.quick_description, event._id));       
            };

        fetchFriendsEvents()
            .then(function(res) {
                let friendsIndex = 0;
                res.forEach((event) => {
                    $('#friendsEventsDiv').prepend(`${event.title} <a href="/event_new.html?_id=${event._id}">link</a> <br>`);

                    fillCarousel('Friends', friendsIndex, event);
                    if (event.image) {
                        friendsIndex++;
                    }
                });
            })
            .catch(function(err){
                console.log(err);
            });


        fetchEventsByLocation()
            .then(function(res) {
                console.log(res);
                
                    let foodIndex = 0;
                    let showsIndex = 0;
                    let othersIndex = 0;
                res.forEach((event) => {
                    
                    $('#eventsByLocationDiv').prepend(`${event.title} <a href="/event_new.html?_id=${event._id}">link</a> <br>`);
                    if (event.category == 'Food') {
                        fillCarousel('Food', foodIndex, event);
                        foodIndex++;
                    } else if(event.category == 'Show'){
                        fillCarousel('Show', showsIndex, event);
                        showsIndex++;
                    } else {
                        fillCarousel('Others', othersIndex, event);
                        othersIndex++;
                    }
                });
            })
            .catch(function(err){
                console.log(err);
            });
            $('#myCarouselFood').carousel({
            interval: 10000
            })
            
            $('#myCarouselFood').on('slid.bs.carousel', function() {
                //alert("slid");
            });
            $('#myCarouselShow').carousel({
            interval: 10000
            })
            
            $('#myCarouselShow').on('slid.bs.carousel', function() {
                //alert("slid");
            });
            $('#myCarouselOthers').carousel({
            interval: 10000
            })
            
            $('#myCarouselOthers').on('slid.bs.carousel', function() {
                //alert("slid");
            });
            $('#myCarouselFriends').carousel({
            interval: 10000
            })
            
            $('#myCarouselFriends').on('slid.bs.carousel', function() {
                //alert("slid");
            });
        
  </script>
</body>
</html>