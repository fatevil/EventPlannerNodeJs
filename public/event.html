<!DOCTYPE html>
<html>
<head>
  <title>Event planner</title>
  <base href="/">
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap-theme.min.css">

</head>
<body ng-view>

  <div class="navbar navbar-default">
    <div class="container">
      <div id="navbar-main">
        <ul class="nav navbar-nav">
          <li><a href="/">Home</a></li>
          <li><a href="/events.html">Events</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/login.html">Sign in</a></li>
          <li><a href="/profile.html"></a></li>
        </ul>
      </div>
    </div>
  </div>

    <div class="container">
        <div class="row">
            
            <div class="col-md-6">

                <h1 class="form-signin-heading">Event</h1>

                <form  class="form-horizontal">
                    <div class="form-group">
                    <label class="col-sm-3 control-label">Title</label>
                    <p class="form-control-static" id="titleParagraph"></p>
                    </div>
                    <label class="col-sm-3 control-label">Place</label>
                    <p class="form-control-static" id="placeParagraph"></p>
                    </div>
                    <label class="col-sm-3 control-label">lat</label>
                    <p class="form-control-static" id="latParagraph"></p>
                    </div>
                    <label class="col-sm-3 control-label">lng</label>
                    <p class="form-control-static" id="lngParagraph"></p>
                    </div>
                    <label class="col-sm-3 control-label">date</label>
                    <p class="form-control-static" id="dateParagraph"></p>
                    </div>
                    <button type="button" id="attendEvent" class="btn btn-primary">Attend</button>
                    <button type="button" id="unattendEvent" class="btn btn-primary">Unattend</button>
                    <hr>
                    <label class="col-sm-12 control-label">Attending people</label>
                    <div id="attendingPeopleDiv" class="form-group">
                    </div>
                    <hr>
                    <label class="col-sm-12 control-label">Events from followed</label>
                    <div id="friendsEventsDiv" class="form-group">
                    </div>
                    <hr>
                    <label class="col-sm-12 control-label">Events by location</label>
                    <div id="eventsByLocationDiv" class="form-group">
                    </div>
                    <hr>
                    <label class="col-sm-12 control-label">All Events</label>
                    <div id="eventsDiv" class="form-group">
                    </div>
                </form>
            </div>

        </div>
    </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="js/authentication.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/common.js"></script>
  <script src="js/events.js"></script>
    <script src="js/profiles.js"></script>
  <script>
        
        fetchAllEvents()
            .then(function(res) {
                //console.log(res);
                res.forEach((event) => {
                  $('#eventsDiv').prepend(`${event.title} <a href="/event.html?_id=${event._id}">link</a> <br>`);
                });
            })
            .catch(function(err){
                console.log(err);
            });
        fetchFriendsEvents()
            .then(function(res) {
                console.log(res);
                const events = eval("(" + res + ")");
            

                Object.keys(events).map((e) => {
                    $('#friendsEventsDiv').prepend(`${events[e]} ${e} <a href="/event.html?_id=${events[e]}">link</a> <br>`);
                });

            })
            .catch(function(err){
                console.log(err);
            });
        fetchEventsByLocation()
            .then(function(res) {
                //console.log(res);
                res.forEach((event) => {
                  $('#eventsByLocationDiv').prepend(`${event.title} <a href="/event.html?_id=${event._id}">link</a> <br>`);
                });
            })
            .catch(function(err){
                console.log(err);
            });

        const eventId = getUrlParameter('_id');
        if (eventId) {
            fetchEventById(eventId)
                .then(function(event){
                    console.log(event);
                    $('#titleParagraph').text(event.title);

                    $('#placeParagraph').text(event.place_address);
                    $('#latParagraph').text(event.place_address_lat);
                    $('#lngParagraph').text(event.place_address_lng);
                    $('#dateParagraph').text(event.date);
                    event.attending.forEach((id) => {
                        $('#attendingPeopleDiv').append(`${id} <br>`);
                    });

                })
                .catch(function(err){
                    console.log(err);
                });
        }

        // id taken from url
        $('#attendEvent').on('click', function() {
            attendEvent(eventId)
                .then(function(result) {
                    //console.log(result);
                })
                .catch(function(err) {
                    console.log(err);
                });
        });

        // id taken from url
        $('#unattendEvent').on('click', function() {
            unattendEvent(eventId)
                .then(function(result) {
                    //console.log(result);
                })
                .catch(function(err) {
                    console.log(err);
                });
        });
  </script>
</body>
</html>